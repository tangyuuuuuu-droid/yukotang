<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>ç‚«èˆåœ†å®åŠ©æ‰‹</title>
    
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            background-color: #f4f5f7;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        h1 { color: #333; }
        
        /* åŠ è½½æç¤ºæ ·å¼ */
        #loading {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>

<h1>æ¬¢è¿æ¥åˆ°ç‚«èˆä¸–ç•Œ ğŸ’ƒ</h1>

<!-- åŠ è½½æç¤º -->
<div id="loading">æ­£åœ¨åŠ è½½èŠå¤©åŠ©æ‰‹...</div>

<!-- å¼•å…¥ Coze SDK -->
<script src="https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/1.2.0-beta.20/libs/cn/index.js"></script>

<script>
    // æ˜¾ç¤ºåŠ è½½æç¤º
    document.getElementById('loading').style.display = 'block';
    
    // ğŸ”§ æ ¸å¿ƒä¿®å¤ï¼šç­‰å¾… SDK åŠ è½½å®Œæˆ
    window.addEventListener('load', function() {
        
        // âœ… ä¿®å¤ï¼šå…ˆå£°æ˜å˜é‡ï¼Œä» sessionStorage è¯»å–
        let clientUserId = sessionStorage.getItem('coze_user_id');
        
        if (!clientUserId) {
            // ç”Ÿæˆå”¯ä¸€IDï¼šæ—¶é—´æˆ³ + åŒé‡éšæœºæ•°ï¼ˆç¡®ä¿ç»å¯¹ä¸é‡å¤ï¼‰
            clientUserId = 'user_' + new Date().getTime() + '_' + 
                          Math.random().toString(36).slice(2) + 
                          Math.random().toString(36).slice(2);
            sessionStorage.setItem('coze_user_id', clientUserId);
        }
        
        console.log('ğŸ”‘ å½“å‰ç”¨æˆ·ID:', clientUserId); // æ–¹ä¾¿è°ƒè¯•
        
        // ğŸ”§ ç”Ÿæˆç‹¬ç«‹çš„ Conversation IDï¼ˆæ¯æ¬¡åˆ·æ–°éƒ½ä¸åŒï¼‰
        const conversationId = 'conv_' + new Date().getTime() + '_' + 
                              Math.random().toString(36).slice(2);
        console.log('ğŸ’¬ å½“å‰ä¼šè¯ID:', conversationId);
        
        // ğŸ”§ ä¿®å¤2ï¼šæ·»åŠ é”™è¯¯å¤„ç†
        try {
            const cozeWebSDK = new CozeWebSDK.WebChatClient({
                config: {
                    bot_id: '7606037508790992923',
                },
                auth: {
                    type: 'token',
                    token: 'pat_vShCWDu8XIDPZhUI5NVJCwBKa95jZTY7kQsJBwvHUAz3RErR8u2aCff9pN3LIMOh',
                    onRefreshToken: async () => ''
                },
                userInfo: {
                    id: clientUserId, // âœ… ä½¿ç”¨ç”Ÿæˆçš„ç”¨æˆ·ID
                    url: 'https://lf-coze-web-cdn.coze.cn/obj/eden-cn/lm-lgvj/ljhwZthlaukjlkulzlp/coze/coze-logo.png',
                    nickname: 'ç‚«èˆç©å®¶_' + clientUserId.slice(-6), // æ˜¾ç¤ºIDå6ä½
                },
                conversation_id: conversationId, // âœ… ä½¿ç”¨ç‹¬ç«‹çš„ä¼šè¯ID
                ui: {
                    base: {
                        icon: 'https://lf-coze-web-cdn.coze.cn/obj/eden-cn/lm-lgvj/ljhwZthlaukjlkulzlp/coze/chatsdk-logo.png',
                        layout: 'pc',
                        lang: 'zh-CN',
                        zIndex: 9999 // æé«˜å±‚çº§ï¼Œé˜²æ­¢è¢«é®æŒ¡
                    },
                    header: {
                        isShow: true,
                        isNeedClose: true,
                    },
                    footer: {
                        isShow: false,
                    },
                    chatBot: {
                        title: 'ç‚«èˆåœ†å®åŠ©æ‰‹',
                        width: 600,
                        isNeedAudio: false,
                        isNeedFeedback: true,
                        feedback: {
                            isNeedFeedback: true,
                            feedbackPanel: {
                                title: 'å›ç­”å¾—å‡†ç¡®å—ï¼Ÿ',
                                placeholder: 'è¯·å‘Šè¯‰æˆ‘ä»¬å“ªé‡Œéœ€è¦æ”¹è¿›...',
                                tags: [
                                    { label: 'å›ç­”ä¸å‡†ç¡®', isNeedDetail: false },
                                    { label: 'é€»è¾‘æ··ä¹±', isNeedDetail: false },
                                    { label: 'å…¶ä»–å»ºè®®', isNeedDetail: true },
                                ],
                            },
                        },
                    },
                },
            });
            
            console.log('âœ… Coze SDK åˆå§‹åŒ–æˆåŠŸï¼');
            console.log('ğŸ“Š ç”¨æˆ·ä¿¡æ¯:', { userId: clientUserId, conversationId: conversationId });
            
            // éšè—åŠ è½½æç¤º
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 1000);
            
        } catch (error) {
            console.error('âŒ Coze SDK åˆå§‹åŒ–å¤±è´¥:', error);
            document.getElementById('loading').innerHTML = 'èŠå¤©åŠ©æ‰‹åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•<br>é”™è¯¯: ' + error.message;
            document.getElementById('loading').style.background = 'rgba(255,0,0,0.7)';
        }
    });
</script>

</body>
</html>
